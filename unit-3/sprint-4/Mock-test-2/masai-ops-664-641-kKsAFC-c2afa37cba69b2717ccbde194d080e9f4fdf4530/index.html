<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Page</title>
    <style>
      /* All Your css for Home page goes here  */
      #menu-container{
        display: grid;
        grid-template-columns: repeat(4,1fr);
      }
    </style>
  </head>

  <body>
    <div class="nav">
      <h1>Web Coffee Shop Menu</h1>
      <a href="./index.html">Home</a>
      <a href="./order.html">Ordered</a>
    </div>
    <div id="filter">
      <input type="number" id="lower" />
      <input type="number" id="upper" />
      <button id="filter-btn">Filter</button>
    </div>
    <select id="sort">
      <option value="">Sort By Price</option>
      <option value="asc">Ascending</option>
      <option value="desc">Descending</option>
    </select>
    <h1 id="alert"></h1>
    <div id="menu-container">
      <!-- Here Append All the Items  -->
    </div>
  </body>
  <script>
    // All your JS code for Home Page goes here
    let container=document.getElementById("menu-container");
    let filterbtn=document.getElementById("filter-btn")
    let lrange=document.getElementById("lower");
    let urange=document.getElementById("upper");
    let buylist=JSON.parse(localStorage.getItem("buy"))||[];
    let sortbtn=document.getElementById("sort");

    let heading=document.getElementById("alert");
    let dataforall=[];
    const url = `https://dbioz2ek0e.execute-api.ap-south-1.amazonaws.com/mockapi/get-coffee`;

    fetch(url)
    .then((res)=>{
      return res.json();
    })
    .then((resdata)=>{
      realdata=resdata.data;
      dataforall=resdata.data;
      showData(realdata);
    })
    .catch((error)=>{
      console.log(error);
    })

    function showData(data){
      container.innerHTML=[];
      console.log(data);
      data.forEach((element) => {
        let card=document.createElement("div");

        let img=document.createElement("img")
        img.setAttribute("src",element.image);
        
        let name=document.createElement("h3");
        name.innerText=element.title;

        let price=document.createElement("h5");
        price.innerText=element.price;

        let desc=document.createElement("p");
        desc.innerText=element.description;

        
        
        let ingredients=document.createElement("h5")
        ingredients.innerText=element.ingredients.join(",")

        let buy=document.createElement("button")
        buy.innerText="Buy";
        buy.addEventListener("click",()=>{
          if(buylist==[]){
            heading.innerText=`Successfully Placed Order`;
            buylist.push(element)
            localStorage.setItem("buy",JSON.stringify(buylist));
          }
          else{
            let present=false;
            for(let i=0;i<buylist.length;i++){
              if(buylist[i].name==element.name){
                present=true;
              }
            }
            if(present){
              heading.innerText=`Already Placed Order`;
            }
            else{
              buylist.push(element)
              localStorage.setItem("buy",JSON.stringify(buylist));
              heading.innerText=`Successfully Placed Order`;
            }
          }

        })
        
        card.append(img,name,ingredients,desc,price,buy);
        container.append(card);
      });
    }
     
    filterbtn.addEventListener("click",()=>{
      // console.log(+lrange.value,+urange.value)
      // console.log(dataforall);
      // let newdata=dataforall;
      // console.log(dataforall.price,dataforall.price)
      let newdata=dataforall.filter((elm)=>{
        // console.log(+elm.price,elm.price)
        if(elm.price>=+lrange.value && elm.price<=+urange){
          return true;
        }
      })
      // console.log(filterdata);
      showData(newdata);
    })
    
    sortbtn.addEventListener("click",()=>{
      console.log(sortbtn.value)
      if(sortbtn.value=="asc"){
        fetch(`${url}?sort=price&order=desc`)
        .then((res)=>{
          return res.json();
        })
        .then((fildata)=>{
          // console.log(fildata.data);
          showData(realdata);
        })
      }
      else if(sortbtn.value=="desc"){
        fetch(`${url}?sort=price&order=asc`)
        .then((res)=>{
          return res.json();
        })
        .then((fildata)=>{
          // console.log(fildata.data);
          showData(fildata.data);
        })
        }
      })
    

  </script>
</html>
