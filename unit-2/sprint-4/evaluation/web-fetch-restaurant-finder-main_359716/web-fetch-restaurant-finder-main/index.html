<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Page</title>
    <style>
      /* All Your css for Home page goes here  */
      #restaurant-container{
        display: grid;
        grid-template-columns: repeat(4,1fr);
        width: 90%;
        margin: auto;
        gap: 20px;
      }
      #restaurant-container image{
        width: 100%;
      }
    </style>
  </head>

  <body>
    <div class="nav">
      <h1>Masai Restaurant Finder</h1>
      <a href="./index.html">Home</a>
      <a href="./favourites.html">Favourites</a>
    </div>
    <select id="filter">
      <option value="">Filter By Category</option>
      <option value="cafe">cafe</option>
      <option value="ethnic">ethnic</option>
      <option value="fast_food">fast_food</option>
    </select>
    
    <h1 id="alert"></h1>
    <div id="restaurant-container">
      <!-- Here Append All the Products  -->
    </div>
  </body>
  <script>
    const url = `https://dbioz2ek0e.execute-api.ap-south-1.amazonaws.com/mockapi/getrestaurants?limit=30`;
    // All your JS code for Home Page goes here
    let container=document.getElementById("restaurant-container");
    let filter=document.getElementById("filter");
    let heading=document.getElementById("alert");
    let fetchdata=[];

    filter.addEventListener("change",()=>{
      // console.log(filter.value);
      let filtered_data = fetchdata.filter((element)=>{
        if(element.type==filter.value){
          return true;
        }
        else{
          return false;
        }
      })
      // console.log(filtered_data);
      showuser(filtered_data);

    })

    fetch(url)
    .then((responcedata)=>{
      return responcedata.json();
    })
    .then((actualdata)=>{
      fetchdata=actualdata.data;
      showuser(actualdata.data);

    })
    .catch((error)=>{
      console.log(error);
    })




    function showuser(data){
      container.innerHTML="";
      data.forEach((element) => {
        let box=document.createElement("div");

        let image=document.createElement("img");
        image.setAttribute("src",element.image);

        let name = document.createElement("h1");
        name.innerText=element.name;

        let price = document.createElement("h2");
        price.innerText="â‚¹"+element.price_starts_from;

        let rating = document.createElement("h2");
        rating.innerText=element.rating;

        let favourites=document.createElement("button");
        favourites.innerText="Favourites";
        favourites.addEventListener("click",()=>{
          let favourite_data=JSON.parse(localStorage.getItem("favourites"))||[];

          if(favourite_data===[]){
            heading.innerText="Restaurant Added To Favourites";
            console.log("yes");
          }
        else{
          let present=false;
          for(let i=0;i<favourite_data.length;i++){
            if(favourite_data[i].id===element.id){
              present=true;
            }
          }
          if(present===true){
            heading.innerText="Restaurant Already in Favourites";
            // console.log("yes");
          }
          else{
            // console.log("no");
            favourite_data.push(element);
            localStorage.setItem("favourites",JSON.stringify(favourite_data));
            heading.innerText="Restaurant Added To Favourites";
          }

        }  

        })


        box.append(image,name,price,rating,favourites);
        container.append(box);
      });
    }
  </script>
</html>
